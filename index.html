<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8" />
<title>Puzzle HackTX 15</title>
<!-- License: Public domain -->
<script>
function parse_urls() {
	var params = {},
		match,
		pl     = /\+/g, // Regex for replacing addition symbol with a space
		search = /([^&=]+)=?([^&]*)/g,
		decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
		query  = window.location.search.substring(1);

	while (match = search.exec(query))
		params[decode(match[1])] = decode(match[2]);
	return params;
}

var canvas;
var ctx;
var image;

function draw_scene() {
	window.requestAnimationFrame(draw_scene);
	canvas.width  = window.innerWidth;
	canvas.height = window.innerHeight;
	ctx.fillStyle = '#000000';
	ctx.fillRect(0, 0, canvas.width, canvas.height);
	ctx.drawImage(image, 20+10*Math.sin(2*Math.PI*Date.now()/1000), 10);
}

function run() {
	window.requestAnimationFrame =
		window.requestAnimationFrame || window.mozRequestAnimationFrame ||
		window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

	canvas = document.getElementById('canvas');
	canvas.style.display = '';
	ctx = canvas.getContext('2d');

	params = parse_urls();
	alert("img: " + params['img'] + "\n"
		+ "rows: " + params['rows'] + "\n"
		+ "cols: " + params['cols'] + "\n"
		+ "mode: " + params['mode'] + "\n"
		+ "timer: " + params['timer']);

	image = new Image();
	image.onload = function() {
		alert('Loaded');
		draw_scene();
	}
	image.src = params['img'];
}
</script>
<style>
html, body {
	height: 100%;
	margin: 0;
	padding: 0;
}

#canvas {
	position: absolute;
	width: 100%;
	height: 100%;
	background: #000;
}
</style>
</head>
<body onload="run();">
<div>
<canvas id="canvas" style="display: none"></canvas>
</div>
</body>
</html>